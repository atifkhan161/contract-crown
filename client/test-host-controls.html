<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Host Controls Test</title>
    <link rel="stylesheet" href="src/styles/main.css">
    <link rel="stylesheet" href="src/styles/waiting-room.css">
</head>
<body>
    <div id="app">
        <h1>Host Controls Test</h1>
        
        <div class="test-section">
            <h2>Current State</h2>
            <div id="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>Host Controls Section (should be visible when host)</h2>
            <!-- Copy the exact host controls from waiting-room.html -->
            <section class="host-controls-section hidden" id="host-controls" 
                     aria-labelledby="host-heading">
                <div class="host-controls">
                    <button id="start-game-btn" class="btn btn-primary btn-lg" 
                            disabled
                            aria-label="Start game for all players"
                            tabindex="0">
                        <span class="btn-text">Start Game</span>
                        <span id="start-spinner" class="spinner hidden" aria-hidden="true"></span>
                    </button>
                    <div class="host-info" aria-live="polite">
                        <span class="host-text">You are the host - start the game when all players are ready</span>
                    </div>
                </div>
            </section>
        </div>
        
        <div class="test-section">
            <h2>Test Controls</h2>
            <button onclick="testShowHostControls()" class="btn btn-primary">Show Host Controls</button>
            <button onclick="testHideHostControls()" class="btn btn-secondary">Hide Host Controls</button>
            <button onclick="runDiagnostics()" class="btn btn-success">Run Diagnostics</button>
        </div>
        
        <div class="test-section">
            <h2>Debug Output</h2>
            <pre id="debug-output" style="background: #f5f5f5; padding: 1rem; border-radius: 4px; max-height: 300px; overflow-y: auto;"></pre>
        </div>
    </div>

    <script>
        function log(message) {
            const output = document.getElementById('debug-output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }

        function testShowHostControls() {
            log('Testing show host controls...');
            const hostControls = document.getElementById('host-controls');
            const startButton = document.getElementById('start-game-btn');
            
            if (hostControls) {
                hostControls.classList.remove('hidden');
                log('Removed hidden class from host controls');
                log('Host controls classes: ' + hostControls.classList.toString());
            } else {
                log('ERROR: Host controls element not found!');
            }
            
            if (startButton) {
                startButton.disabled = false;
                log('Enabled start button');
            } else {
                log('ERROR: Start button not found!');
            }
            
            updateTestResults();
        }

        function testHideHostControls() {
            log('Testing hide host controls...');
            const hostControls = document.getElementById('host-controls');
            
            if (hostControls) {
                hostControls.classList.add('hidden');
                log('Added hidden class to host controls');
                log('Host controls classes: ' + hostControls.classList.toString());
            } else {
                log('ERROR: Host controls element not found!');
            }
            
            updateTestResults();
        }

        function runDiagnostics() {
            log('=== RUNNING DIAGNOSTICS ===');
            
            const hostControls = document.getElementById('host-controls');
            const startButton = document.getElementById('start-game-btn');
            
            log('Host controls element: ' + (hostControls ? 'FOUND' : 'NOT FOUND'));
            log('Start button element: ' + (startButton ? 'FOUND' : 'NOT FOUND'));
            
            if (hostControls) {
                const computedStyle = getComputedStyle(hostControls);
                log('Host controls display: ' + computedStyle.display);
                log('Host controls visibility: ' + computedStyle.visibility);
                log('Host controls opacity: ' + computedStyle.opacity);
                log('Host controls classes: ' + hostControls.classList.toString());
                log('Has hidden class: ' + hostControls.classList.contains('hidden'));
            }
            
            if (startButton) {
                log('Start button disabled: ' + startButton.disabled);
                log('Start button classes: ' + startButton.classList.toString());
                log('Start button display: ' + getComputedStyle(startButton).display);
            }
            
            // Check CSS rules
            const hiddenRules = [];
            for (let sheet of document.styleSheets) {
                try {
                    for (let rule of sheet.cssRules) {
                        if (rule.selectorText && rule.selectorText.includes('.hidden')) {
                            hiddenRules.push(rule.cssText);
                        }
                    }
                } catch (e) {
                    log('Could not access stylesheet: ' + e.message);
                }
            }
            
            log('Found .hidden CSS rules: ' + hiddenRules.length);
            hiddenRules.forEach(rule => log('  ' + rule));
            
            log('=== DIAGNOSTICS COMPLETE ===');
            updateTestResults();
        }

        function updateTestResults() {
            const results = document.getElementById('test-results');
            const hostControls = document.getElementById('host-controls');
            const startButton = document.getElementById('start-game-btn');
            
            let html = '<ul>';
            html += '<li>Host Controls Element: ' + (hostControls ? '✅ Found' : '❌ Not Found') + '</li>';
            html += '<li>Start Button Element: ' + (startButton ? '✅ Found' : '❌ Not Found') + '</li>';
            
            if (hostControls) {
                const isHidden = hostControls.classList.contains('hidden');
                const computedDisplay = getComputedStyle(hostControls).display;
                html += '<li>Has Hidden Class: ' + (isHidden ? '❌ Yes' : '✅ No') + '</li>';
                html += '<li>Computed Display: ' + computedDisplay + '</li>';
                html += '<li>Is Visible: ' + (computedDisplay !== 'none' ? '✅ Yes' : '❌ No') + '</li>';
            }
            
            if (startButton) {
                html += '<li>Start Button Disabled: ' + (startButton.disabled ? '❌ Yes' : '✅ No') + '</li>';
            }
            
            html += '</ul>';
            results.innerHTML = html;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            log('Test page loaded');
            updateTestResults();
        });
    </script>
</body>
</html>