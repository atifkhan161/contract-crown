<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Feedback Manager Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .btn-error {
            background-color: #dc3545;
            color: white;
        }

        .btn-error:hover {
            background-color: #c82333;
        }

        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-success {
            background-color: #28a745;
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-info {
            background-color: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background-color: #138496;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        h1 {
            color: #333;
            text-align: center;
        }

        h2 {
            color: #555;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .status-display {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
        }

        .code-example {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <h1>User Feedback Manager Test Page</h1>

    <div class="test-section">
        <h2>Basic Notifications</h2>
        <p>Test different types of notifications with various durations:</p>

        <div class="test-buttons">
            <button class="btn-error" onclick="testError()">Show Error</button>
            <button class="btn-warning" onclick="testWarning()">Show Warning</button>
            <button class="btn-success" onclick="testSuccess()">Show Success</button>
            <button class="btn-info" onclick="testInfo()">Show Info</button>
            <button class="btn-secondary" onclick="testPersistent()">Persistent Error</button>
        </div>

        <div class="code-example">
            userFeedbackManager.showError('This is an error message');
            userFeedbackManager.showWarning('This is a warning message');
            userFeedbackManager.showSuccess('This is a success message');
            userFeedbackManager.showInfo('This is an info message');
        </div>
    </div>

    <div class="test-section">
        <h2>Loading States</h2>
        <p>Test loading indicators and overlays:</p>

        <div class="test-buttons">
            <button class="btn-info" onclick="testLoading()">Show Loading</button>
            <button class="btn-info" onclick="testLoadingOverlay()">Loading Overlay</button>
            <button class="btn-secondary" onclick="hideAllLoading()">Hide All Loading</button>
        </div>

        <div class="code-example">
            userFeedbackManager.showLoading('operation', 'Loading...', false);
            userFeedbackManager.showLoading('overlay', 'Processing...', true);
            userFeedbackManager.hideLoading('operation');
        </div>
    </div>

    <div class="test-section">
        <h2>Connection Status</h2>
        <p>Test connection status indicators:</p>

        <div class="test-buttons">
            <button class="btn-success" onclick="testConnected()">Connected</button>
            <button class="btn-warning" onclick="testReconnecting()">Reconnecting</button>
            <button class="btn-error" onclick="testDisconnected()">Disconnected</button>
        </div>

        <div class="code-example">
            userFeedbackManager.showConnectionStatus(true, false); // Connected
            userFeedbackManager.showConnectionStatus(true, true); // Reconnecting
            userFeedbackManager.showConnectionStatus(false, false); // Disconnected
        </div>
    </div>

    <div class="test-section">
        <h2>Error Handling</h2>
        <p>Test specific error handling methods:</p>

        <div class="test-buttons">
            <button class="btn-error" onclick="testWebsocketError()">WebSocket Error</button>
            <button class="btn-error" onclick="testAuthError()">Auth Error</button>
            <button class="btn-error" onclick="testApiError()">API Error</button>
            <button class="btn-error" onclick="testRoomError()">Room Error</button>
        </div>

        <div class="code-example">
            userFeedbackManager.handleWebsocketError(error, 'connection');
            userFeedbackManager.handleAuthError(error, 'login');
            userFeedbackManager.handleApiError(error, 'api-call');
            userFeedbackManager.handleRoomError(error, 'join');
        </div>
    </div>

    <div class="test-section">
        <h2>Management</h2>
        <p>Test notification management functions:</p>

        <div class="test-buttons">
            <button class="btn-secondary" onclick="clearAll()">Clear All</button>
            <button class="btn-secondary" onclick="clearErrors()">Clear Errors</button>
            <button class="btn-info" onclick="showStatus()">Show Status</button>
            <button class="btn-info" onclick="testMultiple()">Multiple Notifications</button>
        </div>

        <div class="status-display" id="status">
            Status will appear here...
        </div>

        <div class="code-example">
            userFeedbackManager.clearAllNotifications();
            userFeedbackManager.clearNotificationsByType('error');
            userFeedbackManager.getNotificationCount();
            userFeedbackManager.isLoading();
        </div>
    </div>

    <script>
        // Simplified UserFeedbackManager for testing (inline implementation)
        class UserFeedbackManager {
            constructor() {
                this.notifications = new Map();
                this.loadingStates = new Map();
                this.notificationCounter = 0;
                this.defaultDuration = 5000;
                this.maxNotifications = 5;
                this.init();
            }

            init() {
                this.createNotificationContainer();
                this.setupGlobalErrorHandler();
            }

            createNotificationContainer() {
                if (document.getElementById('notification-container')) return;

                const container = document.createElement('div');
                container.id = 'notification-container';
                container.className = 'notification-container';
                container.innerHTML = `
                    <style>
                        .notification-container {
                            position: fixed;
                            top: 20px;
                            right: 20px;
                            z-index: 10000;
                            max-width: 400px;
                        }
                        .notification {
                            background: #333;
                            color: white;
                            padding: 12px 16px;
                            margin-bottom: 8px;
                            border-radius: 4px;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                            animation: slideIn 0.3s ease-out;
                            position: relative;
                            word-wrap: break-word;
                        }
                        .notification.error { background: #dc3545; }
                        .notification.warning { background: #ffc107; color: #212529; }
                        .notification.success { background: #28a745; }
                        .notification.info { background: #17a2b8; }
                        .notification-close {
                            position: absolute;
                            top: 4px;
                            right: 8px;
                            background: none;
                            border: none;
                            color: inherit;
                            cursor: pointer;
                            font-size: 16px;
                            opacity: 0.7;
                        }
                        .notification-close:hover { opacity: 1; }
                        @keyframes slideIn {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                        .loading-overlay {
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: rgba(0,0,0,0.5);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            z-index: 9999;
                        }
                        .loading-spinner {
                            width: 40px;
                            height: 40px;
                            border: 4px solid #f3f3f3;
                            border-top: 4px solid #3498db;
                            border-radius: 50%;
                            animation: spin 1s linear infinite;
                        }
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                        .loading-text {
                            color: white;
                            margin-top: 16px;
                            font-size: 16px;
                        }
                    </style>
                `;
                document.body.appendChild(container);
            }

            setupGlobalErrorHandler() {
                window.addEventListener('error', (event) => {
                    this.showError('An unexpected error occurred. Please try again.');
                });
                window.addEventListener('unhandledrejection', (event) => {
                    this.showError('A network or processing error occurred. Please try again.');
                });
            }

            showNotification(message, type = 'info', duration = null) {
                const id = ++this.notificationCounter;
                const actualDuration = duration !== null ? duration : this.defaultDuration;

                if (this.notifications.size >= this.maxNotifications) {
                    const oldestId = Math.min(...this.notifications.keys());
                    this.removeNotification(oldestId);
                }

                const notification = { id, message, type, duration: actualDuration, timestamp: Date.now() };
                this.notifications.set(id, notification);
                this.renderNotification(notification);

                if (actualDuration > 0) {
                    setTimeout(() => this.removeNotification(id), actualDuration);
                }
                return id;
            }

            showError(message, duration = 8000) { return this.showNotification(message, 'error', duration); }
            showWarning(message, duration = 6000) { return this.showNotification(message, 'warning', duration); }
            showSuccess(message, duration = 4000) { return this.showNotification(message, 'success', duration); }
            showInfo(message, duration = 5000) { return this.showNotification(message, 'info', duration); }

            renderNotification(notification) {
                const container = document.getElementById('notification-container');
                if (!container) return;

                const element = document.createElement('div');
                element.className = `notification ${notification.type}`;
                element.id = `notification-${notification.id}`;
                element.innerHTML = `
                    ${notification.message}
                    <button class="notification-close" onclick="userFeedbackManager.removeNotification(${notification.id})">&times;</button>
                `;
                container.appendChild(element);
            }

            removeNotification(id) {
                const element = document.getElementById(`notification-${id}`);
                if (element) {
                    element.style.animation = 'slideIn 0.3s ease-out reverse';
                    setTimeout(() => element.remove(), 300);
                }
                this.notifications.delete(id);
            }

            clearAllNotifications() {
                this.notifications.clear();
                const container = document.getElementById('notification-container');
                if (container) {
                    container.querySelectorAll('.notification').forEach(n => n.remove());
                }
            }

            clearNotificationsByType(type) {
                const toRemove = [];
                for (const [id, notification] of this.notifications) {
                    if (notification.type === type) toRemove.push(id);
                }
                toRemove.forEach(id => this.removeNotification(id));
            }

            showLoading(key, message = 'Loading...', overlay = false) {
                const loadingState = { key, message, overlay, timestamp: Date.now() };
                this.loadingStates.set(key, loadingState);
                if (overlay) this.renderLoadingOverlay(loadingState);
            }

            hideLoading(key) {
                const loadingState = this.loadingStates.get(key);
                if (!loadingState) return;
                this.loadingStates.delete(key);
                if (loadingState.overlay) this.removeLoadingOverlay(key);
            }

            renderLoadingOverlay(loadingState) {
                this.removeLoadingOverlay(loadingState.key);
                const overlay = document.createElement('div');
                overlay.className = 'loading-overlay';
                overlay.id = `loading-overlay-${loadingState.key}`;
                overlay.innerHTML = `
                    <div>
                        <div class="loading-spinner"></div>
                        <div class="loading-text">${loadingState.message}</div>
                    </div>
                `;
                document.body.appendChild(overlay);
            }

            removeLoadingOverlay(key) {
                const overlay = document.getElementById(`loading-overlay-${key}`);
                if (overlay) overlay.remove();
            }

            handleWebsocketError(error, context = '') {
                const contextMessage = context ? ` (${context})` : '';
                this.showError(`Connection issue${contextMessage}. Trying to reconnect...`, 6000);
            }

            handleAuthError(error, context = '') {
                this.showError('Authentication failed. Please refresh the page and try again.', 0);
            }

            handleApiError(error, context = '') {
                let message = 'An error occurred. Please try again.';
                if (error.status === 401) message = 'Session expired. Please refresh the page.';
                else if (error.status === 403) message = 'Access denied. Please check your permissions.';
                else if (error.status === 404) message = 'Resource not found. Please refresh the page.';
                else if (error.status >= 500) message = 'Server error. Please try again in a moment.';
                else if (error.message) message = error.message;

                const contextMessage = context ? ` (${context})` : '';
                this.showError(`${message}${contextMessage}`, 8000);
            }

            handleRoomError(error, operation = '') {
                let message = 'Room operation failed. Please try again.';
                if (operation === 'join') message = 'Failed to join room. Please check the room code and try again.';
                else if (operation === 'ready') message = 'Failed to update ready status. Please try again.';
                else if (operation === 'team') message = 'Failed to update team assignment. Please try again.';
                else if (operation === 'start') message = 'Failed to start game. Please ensure all players are ready.';
                this.showError(message, 6000);
            }

            showConnectionStatus(isConnected, isReconnecting = false) {
                if (isReconnecting) this.showWarning('Reconnecting...', 0);
                else if (isConnected) {
                    this.clearNotificationsByType('warning');
                    this.showSuccess('Connected', 2000);
                } else this.showError('Disconnected. Attempting to reconnect...', 0);
            }

            getLoadingStates() { return Array.from(this.loadingStates.values()); }
            isLoading(key = null) { return key ? this.loadingStates.has(key) : this.loadingStates.size > 0; }
            getNotificationCount(type = null) {
                return type ? Array.from(this.notifications.values()).filter(n => n.type === type).length : this.notifications.size;
            }
        }

        // Create global instance
        const userFeedbackManager = new UserFeedbackManager();
        window.userFeedbackManager = userFeedbackManager;

        // Test functions
        function testError() {
            userFeedbackManager.showError('This is a test error message that will disappear after 8 seconds');
        }

        function testWarning() {
            userFeedbackManager.showWarning('This is a test warning message that will disappear after 6 seconds');
        }

        function testSuccess() {
            userFeedbackManager.showSuccess('This is a test success message that will disappear after 4 seconds');
        }

        function testInfo() {
            userFeedbackManager.showInfo('This is a test info message that will disappear after 5 seconds');
        }

        function testPersistent() {
            userFeedbackManager.showError('This is a persistent error message that won\'t disappear automatically', 0);
        }

        function testLoading() {
            userFeedbackManager.showLoading('test-operation', 'Loading test operation...', false);
            setTimeout(() => {
                userFeedbackManager.hideLoading('test-operation');
                userFeedbackManager.showSuccess('Operation completed!');
            }, 3000);
        }

        function testLoadingOverlay() {
            userFeedbackManager.showLoading('overlay-test', 'Processing with overlay...', true);
            setTimeout(() => {
                userFeedbackManager.hideLoading('overlay-test');
                userFeedbackManager.showSuccess('Overlay operation completed!');
            }, 2000);
        }

        function hideAllLoading() {
            const loadingStates = userFeedbackManager.getLoadingStates();
            loadingStates.forEach(state => userFeedbackManager.hideLoading(state.key));
        }

        function testConnected() {
            userFeedbackManager.showConnectionStatus(true, false);
        }

        function testReconnecting() {
            userFeedbackManager.showConnectionStatus(true, true);
        }

        function testDisconnected() {
            userFeedbackManager.showConnectionStatus(false, false);
        }

        function testWebsocketError() {
            const error = new Error('WebSocket connection failed');
            userFeedbackManager.handleWebsocketError(error, 'test connection');
        }

        function testAuthError() {
            const error = new Error('Authentication failed');
            userFeedbackManager.handleAuthError(error, 'test login');
        }

        function testApiError() {
            const error = { status: 500, message: 'Internal server error' };
            userFeedbackManager.handleApiError(error, 'test API call');
        }

        function testRoomError() {
            const error = new Error('Room operation failed');
            userFeedbackManager.handleRoomError(error, 'join');
        }

        function clearAll() {
            userFeedbackManager.clearAllNotifications();
        }

        function clearErrors() {
            userFeedbackManager.clearNotificationsByType('error');
        }

        function showStatus() {
            const status = document.getElementById('status');
            const totalNotifications = userFeedbackManager.getNotificationCount();
            const errorCount = userFeedbackManager.getNotificationCount('error');
            const warningCount = userFeedbackManager.getNotificationCount('warning');
            const successCount = userFeedbackManager.getNotificationCount('success');
            const infoCount = userFeedbackManager.getNotificationCount('info');
            const isLoading = userFeedbackManager.isLoading();
            const loadingStates = userFeedbackManager.getLoadingStates();

            status.innerHTML = `
                <strong>Current Status:</strong><br>
                Total Notifications: ${totalNotifications}<br>
                Errors: ${errorCount}, Warnings: ${warningCount}, Success: ${successCount}, Info: ${infoCount}<br>
                Loading: ${isLoading ? 'Yes' : 'No'}<br>
                Active Loading States: ${loadingStates.map(s => s.key).join(', ') || 'None'}
            `;
        }

        function testMultiple() {
            userFeedbackManager.showError('Error 1');
            setTimeout(() => userFeedbackManager.showWarning('Warning 1'), 200);
            setTimeout(() => userFeedbackManager.showInfo('Info 1'), 400);
            setTimeout(() => userFeedbackManager.showSuccess('Success 1'), 600);
            setTimeout(() => userFeedbackManager.showError('Error 2'), 800);
        }

        // Show initial status when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(showStatus, 100);
        });
    </script>
</body>

</html>